import { useState } from "react";
import { Button } from "@/components/ui/button";
import { MessageCircle, Award, Briefcase, Shield, Lock, FileCheck, MapPin } from "lucide-react";

interface Expert {
  name: string;
  title: string;
  region: string;
  photo: string;
  bio: string;
  certifications: string[];
  tags: string[];
  experience: string;
  background: "legal" | "infosec" | "certification";
}

const backgroundIcons = {
  legal: Shield,
  infosec: Lock,
  certification: FileCheck,
};

const backgroundLabels = {
  legal: "æ³•å¾‹èƒŒæ™¯",
  infosec: "ä¿¡æ¯å®‰å…¨èƒŒæ™¯",
  certification: "è®¤è¯å®¡è®¡èƒŒæ™¯",
};

const regionFlags: Record<string, string> = {
  "æ–°åŠ å¡": "ğŸ‡¸ğŸ‡¬",
  "æ³°å›½": "ğŸ‡¹ğŸ‡­",
  "é©¬æ¥è¥¿äºš": "ğŸ‡²ğŸ‡¾",
  "è¶Šå—": "ğŸ‡»ğŸ‡³",
  "å°åº¦å°¼è¥¿äºš": "ğŸ‡®ğŸ‡©",
  "è²å¾‹å®¾": "ğŸ‡µğŸ‡­",
};

const experts: Expert[] = [
  {
    name: "é™ˆä¼Ÿæ˜",
    title: "CIPP/A è®¤è¯ä¸“å®¶",
    region: "æ–°åŠ å¡",
    photo: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=300&h=300&fit=crop&crop=face",
    bio: "8å¹´æ–°åŠ å¡ PDPA å®æ“ç»éªŒï¼Œä¸»å¯¼è¿‡ 20+ äº’è”ç½‘å¹³å°åˆè§„å®¡è®¡ã€‚æ›¾ä»»èŒäºæ–°åŠ å¡ä¸ªäººæ•°æ®ä¿æŠ¤å§”å‘˜ä¼šã€‚",
    certifications: ["CIPP/A", "CIPM"],
    tags: ["ä¸­æ–‡æµåˆ©", "æ›¾ä»»èŒäºç›‘ç®¡æœºæ„"],
    experience: "8å¹´+",
    background: "certification",
  },
  {
    name: "Somchai Patel",
    title: "æ³°å›½ PDPA é¦–å¸­é¡¾é—®",
    region: "æ³°å›½",
    photo: "https://images.unsplash.com/photo-1545167622-3a6ac756afa4?w=300&h=300&fit=crop&crop=face",
    bio: "æ³°å›½æœ¬åœ°å¾‹å¸ˆï¼Œæ·±è€• PDPA æ³•è§„è§£è¯»ä¸ä¼ä¸šè½åœ°å®æ–½ã€‚æœåŠ¡å®¢æˆ·æ¶µç›–åˆ¶é€ ä¸šã€é›¶å”®ä¸šã€‚",
    certifications: ["Thai Bar", "PDPA Cert"],
    tags: ["æ³°è¯­æ¯è¯­", "æœ¬åœ°åŒ–ä¸“å®¶"],
    experience: "10å¹´+",
    background: "legal",
  },
  {
    name: "Ahmad Rahman",
    title: "é©¬æ¥è¥¿äºš DPO",
    region: "é©¬æ¥è¥¿äºš",
    photo: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=300&h=300&fit=crop&crop=face",
    bio: "é©¬æ¥è¥¿äºšæ³¨å†Œå¾‹å¸ˆï¼Œç²¾é€š PDPA 2010 ä¸è·¨å¢ƒæ•°æ®ä¼ è¾“è§„åˆ™ã€‚æœåŠ¡è¿‡ 50+ å¤–èµ„ä¼ä¸šã€‚",
    certifications: ["Malaysian Bar", "CIPP/A"],
    tags: ["é©¬æ¥è¯­/è‹±è¯­", "è·¨å¢ƒæ•°æ®ä¸“å®¶"],
    experience: "12å¹´+",
    background: "legal",
  },
  {
    name: "Nguyen Thi Mai",
    title: "è¶Šå—åˆè§„æ€»ç›‘",
    region: "è¶Šå—",
    photo: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=300&h=300&fit=crop&crop=face",
    bio: "è¶Šå—æœ¬åœ°æ³•å¾‹ä¸“å®¶ï¼Œä¸“æ³¨ Decree 13 çš„ä¼ä¸šå®æ–½ä¸æ”¿åºœå…³ç³»ç»´æŠ¤ã€‚",
    certifications: ["Vietnam Bar", "DPO Cert"],
    tags: ["è¶Šå—è¯­æ¯è¯­", "æ”¿åºœå…³ç³»"],
    experience: "9å¹´+",
    background: "infosec",
  },
  {
    name: "Budi Santoso",
    title: "å°å°¼æ•°æ®ä¿æŠ¤é¡¾é—®",
    region: "å°åº¦å°¼è¥¿äºš",
    photo: "https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?w=300&h=300&fit=crop&crop=face",
    bio: "å°å°¼ä¿¡æ¯å®‰å…¨ä¸“å®¶ï¼Œä¸“æ³¨ PDP Law ä¼ä¸šåˆè§„è½åœ°ï¼Œæ›¾ä»»èŒäºå›½é™…å››å¤§å’¨è¯¢å…¬å¸ã€‚",
    certifications: ["CISSP", "CIPP/A"],
    tags: ["å°å°¼è¯­æ¯è¯­", "ä¿¡æ¯å®‰å…¨"],
    experience: "11å¹´+",
    background: "infosec",
  },
  {
    name: "Maria Santos",
    title: "è²å¾‹å®¾ DPA ä¸“å®¶",
    region: "è²å¾‹å®¾",
    photo: "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=300&h=300&fit=crop&crop=face",
    bio: "è²å¾‹å®¾è®¤è¯æ•°æ®ä¿æŠ¤å®˜ï¼Œç²¾é€š DPA 2012 ä¸ NPC ç›‘ç®¡è¦æ±‚ï¼Œæ“…é•¿ä¼ä¸šéšç§æ¡†æ¶æ­å»ºã€‚",
    certifications: ["CPA", "DPO Cert", "ISO 27001 LA"],
    tags: ["è‹±è¯­/ä»–åŠ ç¦„è¯­", "è®¤è¯å®¡è®¡ä¸“å®¶"],
    experience: "7å¹´+",
    background: "certification",
  },
];

interface MapNode {
  city: string;
  country: string;
  x: number;
  y: number;
  isHub: boolean;
  tooltip: string;
}

const mapNodes: MapNode[] = [
  { city: "æ–°åŠ å¡", country: "æ–°åŠ å¡", x: 52, y: 72, isHub: true, tooltip: "æ€»éƒ¨ Â· ç»Ÿä¸€è°ƒåº¦ä¸­å¿ƒ" },
  { city: "æ›¼è°·", country: "æ³°å›½", x: 42, y: 32, isHub: false, tooltip: "å½“åœ°åˆä½œå¾‹æ‰€ Â· åˆè§„ä¸“å®¶" },
  { city: "å‰éš†å¡", country: "é©¬æ¥è¥¿äºš", x: 48, y: 62, isHub: false, tooltip: "å½“åœ°åˆä½œå¾‹æ‰€ Â· åˆè§„ä¸“å®¶" },
  { city: "èƒ¡å¿—æ˜å¸‚", country: "è¶Šå—", x: 55, y: 42, isHub: false, tooltip: "å½“åœ°åˆä½œå¾‹æ‰€ Â· åˆè§„ä¸“å®¶" },
  { city: "é›…åŠ è¾¾", country: "å°åº¦å°¼è¥¿äºš", x: 50, y: 88, isHub: false, tooltip: "å½“åœ°åˆä½œå¾‹æ‰€ Â· åˆè§„ä¸“å®¶" },
  { city: "é©¬å°¼æ‹‰", country: "è²å¾‹å®¾", x: 72, y: 38, isHub: false, tooltip: "å½“åœ°åˆä½œå¾‹æ‰€ Â· åˆè§„ä¸“å®¶" },
];

export default function ExpertProfiles() {
  const [hoveredNode, setHoveredNode] = useState<string | null>(null);

  const openSubscriptionForm = () => {
    window.open("https://tally.so/r/1A7MoQ", "_blank");
  };

  const hubNode = mapNodes.find((n) => n.isHub)!;

  return (
    <section id="experts" className="relative py-24 overflow-hidden">
      {/* Background */}
      <div className="absolute inset-0 bg-gradient-to-b from-background via-klein/5 to-background" />

      <div className="container relative z-10 mx-auto px-4">
        {/* Header */}
        <div className="text-center max-w-3xl mx-auto mb-16 space-y-4 animate-fade-in-up">
          <span className="inline-flex items-center gap-2 px-4 py-2 rounded-full glass-card text-sm text-secondary">
            <Award className="w-4 h-4" />
            åŒºåŸŸä¸“å®¶ç½‘ç»œ
          </span>
          <h2 className="font-display text-3xl md:text-4xl font-bold">
            åŒºåŸŸä¸“å®¶ç½‘ç»œ
          </h2>
          <p className="text-muted-foreground text-lg">
            æˆ‘ä»¬åœ¨æ–°åŠ å¡æ€»éƒ¨ç»Ÿä¸€è°ƒåº¦ï¼Œè”åŠ¨ä¸œå—äºšå„å›½æœ¬åœ°åˆè§„ä¸“å®¶ï¼Œä¸ºæ‚¨æä¾›é«˜æ€§ä»·æ¯”çš„è½åœ°æ”¯æŒ
          </p>
        </div>

        {/* Map Section */}
        <div className="glass-card p-8 mb-16 animate-fade-in-up">
          <div className="relative w-full" style={{ paddingBottom: "50%" }}>
            {/* Map background outline */}
            <div className="absolute inset-0 rounded-xl overflow-hidden">
              <div className="absolute inset-0 bg-klein/10 border border-secondary/10 rounded-xl" />

              {/* Southeast Asia Map Background */}
              <svg
                className="absolute inset-0 w-full h-full opacity-20"
                viewBox="0 0 100 100"
                preserveAspectRatio="xMidYMid meet"
              >
                {/* Simplified Southeast Asia coastline/borders */}
                <path
                  d="M 35 25 Q 40 28, 45 30 L 50 35 Q 55 40, 60 42 L 65 40 Q 70 38, 75 40 L 78 45 Q 80 50, 78 55 L 75 60 Q 72 65, 68 68 L 60 72 Q 55 75, 50 78 L 45 82 Q 40 85, 35 87 L 30 88 Q 25 88, 22 85 L 18 80 Q 15 75, 15 70 L 15 60 Q 16 55, 18 50 L 20 45 Q 22 40, 25 35 L 28 30 Q 32 26, 35 25 Z"
                  fill="hsl(190 100% 50% / 0.1)"
                  stroke="hsl(190 100% 50% / 0.3)"
                  strokeWidth="0.5"
                  strokeDasharray="2,2"
                />
                {/* Additional islands/regions */}
                <circle cx="52" cy="72" r="8" fill="hsl(190 100% 50% / 0.08)" stroke="hsl(190 100% 50% / 0.2)" strokeWidth="0.3" />
                <circle cx="48" cy="62" r="6" fill="hsl(190 100% 50% / 0.08)" stroke="hsl(190 100% 50% / 0.2)" strokeWidth="0.3" />
                <circle cx="72" cy="38" r="5" fill="hsl(190 100% 50% / 0.08)" stroke="hsl(190 100% 50% / 0.2)" strokeWidth="0.3" />
              </svg>

              {/* Grid lines */}
              <div className="absolute inset-0 grid-pattern opacity-10" />

              {/* Connection lines from hub to nodes */}
              <svg className="absolute inset-0 w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
                {mapNodes
                  .filter((n) => !n.isHub)
                  .map((node) => (
                    <line
                      key={node.city}
                      x1={`${hubNode.x}`}
                      y1={`${hubNode.y}`}
                      x2={`${node.x}`}
                      y2={`${node.y}`}
                      stroke="hsl(190 100% 50% / 0.2)"
                      strokeWidth="0.3"
                      strokeDasharray="1,1"
                      className={hoveredNode === node.city ? "!stroke-[hsl(190_100%_50%/0.6)]" : ""}
                    />
                  ))}
              </svg>

              {/* Nodes */}
              {mapNodes.map((node) => (
                <div
                  key={node.city}
                  className="absolute transform -translate-x-1/2 -translate-y-1/2 group cursor-pointer"
                  style={{ left: `${node.x}%`, top: `${node.y}%` }}
                  onMouseEnter={() => setHoveredNode(node.city)}
                  onMouseLeave={() => setHoveredNode(null)}
                >
                  {/* Pulse ring for hub */}
                  {node.isHub && (
                    <>
                      <div className="absolute inset-0 -m-6 rounded-full border-2 border-secondary/30 animate-ping" style={{ animationDuration: "3s" }} />
                      <div className="absolute inset-0 -m-4 rounded-full border-2 border-secondary/20 animate-ping" style={{ animationDuration: "2s", animationDelay: "0.5s" }} />
                    </>
                  )}

                  {/* Dot */}
                  <div
                    className={`rounded-full transition-all duration-300 ${node.isHub
                      ? "w-5 h-5 bg-secondary shadow-[0_0_20px_hsl(190_100%_50%/0.5)]"
                      : "w-3 h-3 bg-secondary/70 hover:bg-secondary hover:shadow-[0_0_15px_hsl(190_100%_50%/0.4)]"
                      }`}
                  />

                  {/* Label */}
                  <div
                    className={`absolute left-1/2 -translate-x-1/2 whitespace-nowrap transition-all duration-300 ${node.isHub ? "-bottom-8" : "-bottom-7"
                      }`}
                  >
                    <span className={`text-xs font-medium ${node.isHub ? "text-secondary" : "text-muted-foreground"}`}>
                      {node.city}
                    </span>
                  </div>

                  {/* Tooltip */}
                  {hoveredNode === node.city && (
                    <div className="absolute left-1/2 -translate-x-1/2 -top-14 z-20 animate-fade-in-up">
                      <div className="glass-card px-3 py-2 text-xs whitespace-nowrap flex items-center gap-1.5">
                        <MapPin className="w-3 h-3 text-secondary" />
                        <span>{node.tooltip}</span>
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* Expert Cards Grid */}
        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {experts.map((expert, index) => {
            const BgIcon = backgroundIcons[expert.background];
            return (
              <div
                key={expert.name}
                className="glass-card p-6 space-y-4 hover:border-secondary/30 transition-all duration-500 group animate-fade-in-up"
                style={{ animationDelay: `${index * 0.1}s` }}
              >
                {/* Photo & Region */}
                <div className="flex items-start gap-4">
                  <div className="shrink-0">
                    <div className="w-20 h-20 rounded-xl overflow-hidden border-2 border-border group-hover:border-secondary/50 transition-colors">
                      <img
                        src={expert.photo}
                        alt={expert.name}
                        className="w-full h-full object-cover"
                      />
                    </div>
                  </div>
                  <div className="flex-1 min-w-0">
                    <h4 className="font-display text-lg font-semibold">{expert.name}</h4>
                    <p className="text-sm text-secondary mt-1">{expert.title}</p>
                  </div>
                </div>

                {/* Region Badge */}
                <div className="flex items-center gap-2">
                  <span className="px-2.5 py-1 rounded-full text-xs font-medium bg-klein/30 border border-secondary/20 text-secondary">
                    {regionFlags[expert.region]} {expert.region}
                  </span>
                  <span className="inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-muted/50 border border-border text-muted-foreground">
                    <BgIcon className="w-3 h-3" />
                    {backgroundLabels[expert.background]}
                  </span>
                </div>

                {/* Bio */}
                <p className="text-sm text-muted-foreground line-clamp-2">
                  {expert.bio}
                </p>

                {/* Tags */}
                <div className="flex flex-wrap gap-2">
                  {expert.tags.map((tag, i) => (
                    <span key={i} className="expert-badge">
                      {tag}
                    </span>
                  ))}
                  <span className="expert-badge">
                    <Briefcase className="w-3 h-3 mr-1" />
                    {expert.experience}
                  </span>
                </div>

                {/* Certifications */}
                <div className="flex items-center gap-2 text-xs text-muted-foreground">
                  <Award className="w-3 h-3" />
                  <span>{expert.certifications.join(" Â· ")}</span>
                </div>
              </div>
            );
          })}
        </div>

        {/* Bottom CTA */}
        <div className="mt-16 text-center animate-fade-in-up">
          <Button variant="glass" size="xl" onClick={openSubscriptionForm}>
            <MessageCircle className="w-5 h-5 mr-2" />
            è®¢é˜…è·å–åˆè§„æ¸…å•
          </Button>
        </div>
      </div>
    </section>
  );
}
